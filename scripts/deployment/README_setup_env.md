# Railway Environment Setup Wizard

**Zero-Touch Configuration for Project 38**

## Overview
Interactive PowerShell wizard that automates Railway deployment environment setup:
- Auto-generates secure passwords (PostgreSQL, Redis, SECRET_KEY)
- Prompts for LLM API keys with format validation
- Creates `.env.production` file
- Optionally chains to `deploy_railway.ps1`

## Quick Start
```powershell
.\scripts\deployment\setup_env.ps1
```

The wizard will guide you through:
1. âœ… Password generation (automatic)
2. ðŸ”‘ API key input (OpenAI and/or Anthropic)
3. ðŸ“„ `.env.production` creation
4. ðŸš€ Optional Railway deployment

## Requirements
- **PowerShell 5.1+** (built-in on Windows)
- **openssl** (optional, for cryptographically secure password generation)
  - Falls back to PowerShell's `System.Security.Cryptography.RNGCryptoServiceProvider`

## Usage Examples

### Standard Interactive Setup
```powershell
.\scripts\deployment\setup_env.ps1
```

### Skip Deployment Prompt
```powershell
.\scripts\deployment\setup_env.ps1 -SkipDeploy
```

### Force Regenerate Existing Config
```powershell
.\scripts\deployment\setup_env.ps1 -RegenerateAll
```

### Custom Output Path
```powershell
.\scripts\deployment\setup_env.ps1 -EnvFile "custom\.env.production"
```

## What Gets Generated

### Automatic (No User Input)
- `POSTGRES_USER=dify`
- `POSTGRES_DB=dify`
- `POSTGRES_PASSWORD` (32-char base64)
- `REDIS_PASSWORD` (32-char base64)
- `SECRET_KEY` (64-char hex)

### Interactive Prompts
- `OPENAI_API_KEY` (format: `sk-...`)
- `ANTHROPIC_API_KEY` (format: `sk-ant-...`)

**Note:** At least ONE LLM provider API key is required.

## Security Features
- âœ… Cryptographically secure random generation (openssl or .NET RNG)
- âœ… Input validation with regex patterns
- âœ… Masked password display in summary
- âœ… `.env.production` excluded from git (via `.gitignore`)

## Output
Creates `infrastructure/.env.production`:
```env
# PostgreSQL Configuration
POSTGRES_USER=dify
POSTGRES_PASSWORD=<auto-generated-32-chars>
POSTGRES_DB=dify

# Redis Configuration
REDIS_PASSWORD=<auto-generated-32-chars>

# Dify Application Secrets
SECRET_KEY=<auto-generated-64-chars>

# LLM Provider API Keys
OPENAI_API_KEY=<user-provided>
ANTHROPIC_API_KEY=<user-provided>
```

## Chaining to Deployment
After successful setup, wizard offers to launch:
```powershell
.\scripts\deployment\deploy_railway.ps1
```

To deploy manually later:
```powershell
.\scripts\deployment\deploy_railway.ps1 -EnvFile infrastructure\.env.production
```

## Troubleshooting

### "openssl not found" Warning
**Impact:** Uses PowerShell fallback RNG (still cryptographically secure)  
**Fix (optional):** Install openssl via Chocolatey:
```powershell
choco install openssl
```

### API Key Format Validation Failed
- **OpenAI:** Must start with `sk-` (at least 32 chars)
- **Anthropic:** Must start with `sk-ant-` (at least 90 chars)
- Wizard offers to continue anyway if format looks wrong

### "At least one LLM provider API key is required"
**Solution:** Provide either OpenAI OR Anthropic key (or both)  
Get keys from:
- OpenAI: https://platform.openai.com/api-keys
- Anthropic: https://console.anthropic.com/settings/keys

## See Also
- [Railway Deployment Guide](README_deploy_railway.md) - Full deployment process
- [Environment Template](.env.template) - All available variables
- [Infrastructure README](../../infrastructure/README.md) - Setup overview
